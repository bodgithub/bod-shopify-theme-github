{%- comment -%}
Bodology subscription widget override
{%- endcomment -%}

{% assign VARIANT_60 = 46444657279195 %}
{% assign VARIANT_90 = 46444646269147 %}

{%- comment -%}
Selling Plan IDs from your checkout links
1-month plan (60 scoops, 2 scoops/day): 6331924699
1.5-month plan (90 scoops, 2 scoops/day): 5755961563
3-month plan (90 scoops, 1 scoop/day): 5755928795
{%- endcomment -%}

{% assign PLAN_1M = 6331924699 %}
{% assign PLAN_15M = 5755961563 %}
{% assign PLAN_3M = 5755928795 %}

{% assign PRICE_ONETIME = 6500 %}   {# $65.00 #}
{% assign PRICE_1M_SUB  = 3600 %}   {# $36.00 #}
{% assign PRICE_15M_SUB = 5200 %}   {# optional: adjust if different #}
{% assign PRICE_3M_SUB  = 5200 %}   {# $52.00 #}

<div class="bd-subscribe-card" id="bd-subscribe-card">
  <div class="bd-card-head">
    <div class="bd-radio selected" data-mode="sub"></div>
    <div class="bd-title">Subscribe & save</div>
    <div class="bd-badge">Most Popular</div>
    <div class="bd-price">
      <s class="bd-strike">{{ PRICE_ONETIME | money }}</s>
      <span class="bd-sale" id="bd-dynamic-price">{{ PRICE_3M_SUB | money }}</span>
    </div>
  </div>

  <ul class="bd-benefits">
    <li>Save 20%, every month.</li>
    <li>Free shipping, always.</li>
    <li>Cancel anytime.</li>
  </ul>

  <div class="bd-subheading">Deliver every:</div>

  <div class="bd-intervals" role="tablist">
    <button type="button"
            class="bd-pill"
            data-variant="{{ VARIANT_60 }}"
            data-plan="{{ PLAN_1M }}"
            data-price="{{ PRICE_1M_SUB }}"
            aria-selected="false">
      <span class="bd-pill-main">1 month</span>
      <span class="bd-pill-sub">save 20%</span>
    </button>

    <button type="button"
            class="bd-pill"
            data-variant="{{ VARIANT_90 }}"
            data-plan="{{ PLAN_15M }}"
            data-price="{{ PRICE_15M_SUB }}"
            aria-selected="false">
      <span class="bd-pill-main">1.5 months</span>
      <span class="bd-pill-sub">save 20%</span>
    </button>

    <button type="button"
            class="bd-pill selected"
            data-variant="{{ VARIANT_90 }}"
            data-plan="{{ PLAN_3M }}"
            data-price="{{ PRICE_3M_SUB }}"
            aria-selected="true">
      <span class="bd-pill-main">3 months</span>
      <span class="bd-pill-sub">save 20%</span>
    </button>
  </div>

  <div class="bd-divider"></div>

  <div class="bd-onetime">
    <div class="bd-radio" data-mode="one"></div>
    <div class="bd-onetime-title">One-time</div>
    <div class="bd-onetime-price">{{ PRICE_ONETIME | money }}</div>
  </div>

  <form id="bd-add-to-cart" action="/cart/add" method="post">
    <input type="hidden" name="id" id="bd-variant-id" value="{{ VARIANT_90 }}">
    <input type="hidden" name="quantity" value="1">
    <input type="hidden" name="selling_plan" id="bd-selling-plan" value="{{ PLAN_3M }}">
    <button type="submit" class="bd-atc">Add to cart</button>
  </form>
</div>

<style>
/* keep the CSS from the earlier snippet, unchanged */
</style>

<script>
(function(){
  var card = document.getElementById('bd-subscribe-card');
  var variantInput = document.getElementById('bd-variant-id');
  var planInput = document.getElementById('bd-selling-plan');
  var priceEl = document.getElementById('bd-dynamic-price');

  var subscribeRadio = card.querySelector('.bd-radio[data-mode="sub"]');
  var oneRadio       = card.querySelector('.bd-radio[data-mode="one"]');
  var pills          = card.querySelectorAll('.bd-pill');
  var form           = document.getElementById('bd-add-to-cart');

  function money(cents){
    return (cents/100).toLocaleString(undefined,{style:'currency',currency:'USD'});
  }

  function selectSubscribe(){
    subscribeRadio.classList.add('selected');
    oneRadio.classList.remove('selected');
    if(!planInput.value){
      var defaultPill = card.querySelector('.bd-pill.selected') || pills[pills.length-1];
      planInput.value = defaultPill.dataset.plan;
      variantInput.value = defaultPill.dataset.variant;
      if(priceEl) priceEl.textContent = money(parseInt(defaultPill.dataset.price,10));
    }
  }

  function selectOneTime(){
    oneRadio.classList.add('selected');
    subscribeRadio.classList.remove('selected');
    planInput.value = '';
    variantInput.value = '{{ VARIANT_90 }}';
    if(priceEl) priceEl.textContent = money({{ PRICE_ONETIME }});
  }

  // Init defaults
  selectSubscribe();

  pills.forEach(function(btn){
    btn.addEventListener('click', function(){
      pills.forEach(function(b){ b.classList.remove('selected'); b.setAttribute('aria-selected','false'); });
      btn.classList.add('selected'); btn.setAttribute('aria-selected','true');
      selectSubscribe();
      variantInput.value = btn.dataset.variant;
      planInput.value = btn.dataset.plan;
      if(priceEl) priceEl.textContent = money(parseInt(btn.dataset.price,10));
    });
  });

  oneRadio.addEventListener('click', selectOneTime);
  subscribeRadio.addEventListener('click', selectSubscribe);

})();
</script>
