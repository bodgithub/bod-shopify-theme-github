<div {{ block.shopify_attributes }}>
	{%- if product != blank -%}
	{%- liquid
      assign gift_card_recipient_feature_active = false
      if block.settings.show_gift_card_recipient and product.gift_card?
        assign gift_card_recipient_feature_active = true
      endif

      assign show_dynamic_checkout = false
      if block.settings.show_dynamic_checkout and gift_card_recipient_feature_active == false
        assign show_dynamic_checkout = true
      endif

			assign product_template = product.template_suffix

			if product.metafields.theme.preorder and product.available
				assign product_template = 'pre-order'
			endif
    -%}
  <product-form class="product-form" data-section="{{ section.id }}" data-hide-errors="{{ gift_card_recipient_feature_active }}" template="{{ product_template | escape }}">
		<div class="product-form__error-message-wrapper form-notification error" role="alert" hidden>
      {% render 'svg-icons' with 'thb-error' %}
      <span class="product-form__error-message"></span>
    </div>

    {% comment %} Dropdown 
    <label for="supply-options">Choose your supply:</label>
<select id="supply-options" name="supply-options">
  <option value="1">1 scoop per day (3-month supply)</option>
  <option value="2">2 scoops per day (3-month supply)</option>
</select>{% endcomment %}
    
		{%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
			
  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
         {% comment %} <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled> {% endcomment %}

          <select id="variant-select" name="id">
  {% for variant in product.variants %}
    <option 
      value="{{ variant.id }}" 
      data-price="{{ variant.price }}" 
      data-compare-at-price="{{ variant.compare_at_price }}"
      data-reward="{% if variant.metafields.custom.reward %}{{ variant.metafields.custom.reward }}{% else %}{% endif %}"
      data-scoops="{{ variant.metafields.custom.scoops }}" 
      data-supply="{{ variant.metafields.custom.supply }}">
      {{ variant.title }}
    </option>
  {% endfor %}
</select>

        


          

			{%- if gift_card_recipient_feature_active -%}
				{%- render 'gift-card-recipient-form', product: product, form: form, section: section -%}
			{%- endif -%}
			<div class="product-add-to-cart-container">
				<div class="form-notification error" style="display:none;"></div>
				<div class="add_to_cart_holder{% if show_dynamic_checkout %} add_to_cart_holder--multi{%- endif -%}">
					<button type="submit" name="add" id="AddToCart" class="single-add-to-cart-button button accent {% unless product.selected_or_first_available_variant.available %}sold-out{% endunless %}" {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}>
						<span class="single-add-to-cart-button--text">
							{%- liquid
								if product.selected_or_first_available_variant.available == false
									assign button_content = 'products.product.sold_out' | t
								else
									if product_template == 'pre-order'
										assign button_content = 'products.product.pre_order' | t
									else
										assign button_content = 'products.product.add_to_cart' | t
									endif
								endif
							-%}
		{{- button_content -}}â€”<span id="variant-price">{{ product.selected_or_first_available_variant.price | money }}</span>
       <span style="font-size:12px;" id="variant-custom-text">{% if product.selected_or_first_available_variant.metafields.custom.reward %}
      {{ product.selected_or_first_available_variant.metafields.custom.reward }}{% endif %}</span> 

						</span>
						<span class="loading-overlay">
							{% render 'svg-icons' with 'thb-loading' %}
						</span>
					</button>
					{%- if show_dynamic_checkout -%}
						{{ form | payment_button }}
					{%- endif -%}
				</div>
			</div>
		{%- endform -%}
	</product-form>
	{%- else -%}
    <div class="product-form">
      <div class="product-form__buttons form">
        <button
          type="submit"
          name="add"
          class="single_add_to_cart_button button sold-out"
          disabled
        >
          <span class="single-add-to-cart-button--text">{{ 'products.product.sold_out' | t }}</span>
        </button>
      </div>
    </div>
  {%- endif -%}
</div>
{%- if pickup -%}
{%- assign pick_up_availabilities = product.selected_or_first_available_variant.store_availabilities | where: 'pick_up_enabled', true -%}
<pickup-availability
	class="pickup-availability-wrapper"
	{% if product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %}available{% endif %}
  data-root-url="{{ routes.root_url }}"
  data-variant-id="{{ product.selected_or_first_available_variant.id }}"
  data-has-only-default-variant="{{ product.has_only_default_variant }}"
>
	{%- assign pick_up_availabilities = product.selected_or_first_available_variant.store_availabilities | where: 'pick_up_enabled', true -%}
	{%- if pick_up_availabilities.size > 0 -%}
		{% render 'product-pickup-availability', pick_up_availabilities: pick_up_availabilities %}
	{% endif %}
</pickup-availability>
<script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
{%- endif -%}







      <script>
        document.addEventListener("DOMContentLoaded", function () {
  const variantSelect = document.getElementById("variant-select");
  const variantPrice = document.getElementById("variant-price");
  const variantCustomText = document.getElementById("variant-custom-text");

  if (variantSelect) {
    variantSelect.addEventListener("change", function () {
      // Trigger Shopify's native logic by submitting the form data
      const form = document.querySelector("form.product-form");
      const selectedVariantId = this.value;

      // Update the hidden input field with the selected variant ID
      const variantInput = form.querySelector('input[name="id"]');
      if (variantInput) {
        variantInput.value = selectedVariantId;
      }

      // Trigger Shopify's default variant change logic
      if (typeof Shopify !== "undefined" && Shopify.Storefront) {
        Shopify.Storefront.variantSelectOnChange(form);
      }

      // Custom price and text updates for the button
      const selectedOption = this.options[this.selectedIndex];
      const price = selectedOption.getAttribute("data-price");
      const reward = selectedOption.getAttribute("data-reward");

      // Update button price dynamically
      if (price) {
        variantPrice.textContent = new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
        }).format(price / 100); // Shopify stores prices in cents
      }

      // Update button custom text
      if (reward) {
        variantCustomText.textContent = ` ${reward}`;
      } else {
        variantCustomText.textContent = ""; // Clear if no reward
      }
    });
  }
});


      </script>
